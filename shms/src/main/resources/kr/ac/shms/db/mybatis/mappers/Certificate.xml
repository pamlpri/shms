<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ac.shms.lms.student.dao.CertificateDAO">
	<select id="selectCrtfList" resultType="CertificateReqVO" parameterType="string">
		SELECT *
		  FROM (
		  SELECT A.*, ROW_NUMBER () OVER (ORDER BY req_de DESC) rn
		    FROM (
		        SELECT 
		            (SELECT COUNT(*) FROM crtf_req WHERE stdnt_no = #{stdnt_no, jdbcType=VARCHAR}  )
		             - (ROW_NUMBER () OVER 
		            (ORDER BY req_de DESC))+1 p_bo_no,
		            req_no,
		            TO_CHAR(req_de, 'YYYY.MM.DD') req_de,
		            no_of_issue,
		           (SELECT com_code_nm
		              FROM tb_com_code
		             WHERE CODE_GRP = (SELECT CODE_GRP FROM TB_CODE_GRP WHERE CODE_GRP_NM = 'CRTF_KIND')
		               AND com_code = crtf_kind) crtf_kind,
		          (SELECT com_code_nm
		               FROM tb_com_code
		              WHERE code_grp = (SELECT code_grp FROM tb_code_grp WHERE CODE_GRP_NM = 'CRTF_REQ_RESN') 
		                AND com_code = crtf_req_resn) crtf_req_resn
		         FROM crtf_req 
		        WHERE stdnt_no = #{stdnt_no, jdbcType=VARCHAR}  
		    ) A
		 )
	</select>
</mapper>